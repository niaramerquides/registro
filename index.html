<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Registro Interativo de Pensamento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3f0071" />
  <style>
    :root {
      --cor1: #001f3f;
      --cor2: #3f0071;
      --cor3: #fce4ec;
      --roxo: #9c27b0;
      --azul: #2196f3;
      --verde: #4caf50;
      --laranja: #ff9800;
      --vermelho: #f44336;
      --cinza: #eceff1;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--cor1), var(--cor2));
      color: #fff;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    .step {
      display: none;
      background-color: #fff;
      color: #333;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    }
    .step.active {
      display: block;
    }
    h2 {
      font-size: 20px;
      display: flex;
      align-items: center;
    }
    .circle {
      display: inline-block;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      text-align: center;
      line-height: 28px;
      font-weight: bold;
      color: #fff;
      margin-right: 10px;
    }
    label, textarea, input[type="range"] {
      display: block;
      margin-top: 10px;
      width: 100%;
    }
    textarea {
      height: 80px;
      border-radius: 8px;
      border: 1px solid #ccc;
      padding: 10px;
      resize: vertical;
      font-size: 14px;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #6a1b9a;
      color: white;
    }
    button:hover {
      background-color: #4a148c;
    }
    .summary {
      background-color: #fff;
      color: #333;
      border-radius: 12px;
      padding: 20px;
    }
    .summary h3 {
      margin-top: 20px;
    }
    .final-buttons {
      display: flex;
      justify-content: space-around;
      margin-top: 30px;
    }
    .final-buttons button {
      background-color: #2196f3;
    }
    .final-buttons button:nth-child(2) {
      background-color: #4caf50;
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="formulario">
      <div class="step active" id="step-0">
        <h2><span class="circle" style="background: var(--azul)">1</span>Situa√ß√£o üß†</h2>
        <label for="situacao">Descreva a situa√ß√£o:</label>
        <textarea id="situacao"></textarea>
        <label for="intensidade1">Intensidade: <span id="val1">0</span></label>
        <input type="range" id="intensidade1" min="0" max="10">
        <div class="nav-buttons">
          <span></span><button type="button" onclick="nextStep()">Pr√≥ximo ‚Üí</button>
        </div>
      </div>
      <div class="step" id="step-1">
        <h2><span class="circle" style="background: var(--roxo)">2</span>Pensamento üí≠</h2>
        <label for="pensamento">Qual foi o pensamento?</label>
        <textarea id="pensamento"></textarea>
        <label for="intensidade2">Intensidade: <span id="val2">0</span></label>
        <input type="range" id="intensidade2" min="0" max="10">
        <div class="nav-buttons">
          <button type="button" onclick="prevStep()">‚Üê Anterior</button>
          <button type="button" onclick="nextStep()">Pr√≥ximo ‚Üí</button>
        </div>
      </div>
      <div class="step" id="step-2">
        <h2><span class="circle" style="background: var(--verde)">3</span>Emo√ß√£o üíì</h2>
        <label for="emocao">O que voc√™ sentiu?</label>
        <textarea id="emocao"></textarea>
        <label for="intensidade3">Intensidade: <span id="val3">0</span></label>
        <input type="range" id="intensidade3" min="0" max="10">
        <div class="nav-buttons">
          <button type="button" onclick="prevStep()">‚Üê Anterior</button>
          <button type="button" onclick="nextStep()">Pr√≥ximo ‚Üí</button>
        </div>
      </div>
      <div class="step" id="step-3">
        <h2><span class="circle" style="background: var(--laranja)">4</span>Lembran√ßa üß†</h2>
        <label for="lembranca">Houve alguma lembran√ßa associada?</label>
        <textarea id="lembranca"></textarea>
        <label for="intensidade4">Intensidade: <span id="val4">0</span></label>
        <input type="range" id="intensidade4" min="0" max="10">
        <div class="nav-buttons">
          <button type="button" onclick="prevStep()">‚Üê Anterior</button>
          <button type="button" onclick="nextStep()">Pr√≥ximo ‚Üí</button>
        </div>
      </div>
      <div class="step" id="step-4">
        <h2><span class="circle" style="background: var(--vermelho)">5</span>Rea√ß√£o ‚ö°</h2>
        <label for="reacao">Qual foi sua rea√ß√£o?</label>
        <textarea id="reacao"></textarea>
        <label for="intensidade5">Intensidade: <span id="val5">0</span></label>
        <input type="range" id="intensidade5" min="0" max="10">
        <div class="nav-buttons">
          <button type="button" onclick="prevStep()">‚Üê Anterior</button>
          <button type="button" onclick="mostrarResumo()">Finalizar ‚úÖ</button>
        </div>
      </div>
    </form>

    <div id="summary" class="step">
      <h2>üìù Seu Registro</h2>
      <div id="resultado"></div>
      <div class="final-buttons">
        <button onclick="reiniciarFormulario()">üîÅ Novo Registro</button>
        <button onclick="exportarPDF()">üìÑ Exportar</button>
      </div>
      <div style="margin-top: 20px;">
        <h3>üí° Por que funciona:</h3>
        <p>Esse exerc√≠cio ajuda a identificar padr√µes de pensamento e suas emo√ß√µes associadas.</p>
        <h3>üîî Lembre-se:</h3>
        <p>Registrar o que sentimos √© um passo importante para compreender e transformar.</p>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    let passoAtual = 0;
    const campos = ["situacao", "pensamento", "emocao", "lembranca", "reacao"];

    function nextStep() {
      document.getElementById(`step-${passoAtual}`).classList.remove("active");
      passoAtual++;
      document.getElementById(`step-${passoAtual}`).classList.add("active");
    }

    function prevStep() {
      document.getElementById(`step-${passoAtual}`).classList.remove("active");
      passoAtual--;
      document.getElementById(`step-${passoAtual}`).classList.add("active");
    }

    function mostrarResumo() {
      const resultado = document.getElementById("resultado");
      let html = "";
      campos.forEach((c, i) => {
        const texto = document.getElementById(c).value;
        const intensidade = document.getElementById(`intensidade${i+1}`).value;
        html += `<h3>${i+1}. ${c.charAt(0).toUpperCase() + c.slice(1)}</h3><p>${texto}</p><strong>Intensidade:</strong> ${intensidade}/10`;
      });
      document.getElementById("summary").classList.add("active");
      document.getElementById(`step-${passoAtual}`).classList.remove("active");
      resultado.innerHTML = html;
    }

    function reiniciarFormulario() {
      location.reload();
    }

    function exportarPDF() {
      const element = document.getElementById("summary");
      html2pdf().from(element).set({
        margin: 0.5,
        filename: 'registro-de-pensamento.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      }).save();
    }

    window.addEventListener("DOMContentLoaded", () => {
      campos.forEach((campo, i) => {
        const area = document.getElementById(campo);
        const range = document.getElementById(`intensidade${i+1}`);
        const label = document.getElementById(`val${i+1}`);

        area.value = localStorage.getItem(campo) || "";
        range.value = localStorage.getItem(`intensidade${i+1}`) || 0;
        label.innerText = range.value;

        area.addEventListener("input", () => localStorage.setItem(campo, area.value));
        range.addEventListener("input", () => {
          localStorage.setItem(`intensidade${i+1}`, range.value);
          label.innerText = range.value;
        });
      });
    });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker registrado'))
        .catch(err => console.error('Erro ao registrar SW:', err));
    }
  </script>
</body>
</html>
